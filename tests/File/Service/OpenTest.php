<?php
/**
 * @copyright  2018 Jack Clayton
 * @license    MIT
 */

namespace Jstewmc\Gravity\File\Service;

use Jstewmc\Gravity\File\Exception\{NotFile, NotReadable};
use Jstewmc\Gravity\File\Data\Opened;
use Jstewmc\Gravity\Ns\Data\Opened as Ns;
use Jstewmc\Gravity\Script\Data\Opened as Script;
use org\bovigo\vfs\{vfsStream, vfsStreamDirectory, vfsStreamFile};
use PHPUnit\Framework\TestCase;

class OpenTest extends TestCase
{
    protected $root;

    protected $file;

    public function setUp(): void
    {
        $this->root = vfsStream::setup('test');

        $this->file = vfsStream::newFile('foo.php')->at($this->root);

        return;
    }

    public function testInvokeIfNotExists(): void
    {
        $this->expectException(NotReadable::class);

        (new Open())('/path/to/bar.php');
    }

    public function testInvokeIfNotReadable(): void
    {
        $this->expectException(NotReadable::class);

        $file = vfsStream::newFile('bar.php', 000)->at($this->root);

        (new Open())($file->url());
    }

    public function testInvokeIfNotFile(): void
    {
        $this->expectException(NotFile::class);

        (new Open())($this->root->url());
    }

    public function testInvoke(): void
    {
        $expected = new Opened($this->file->url(), new Ns(), new Script());
        $actual   = (new Open())($this->file->url());

        $this->assertEquals($expected, $actual);
    }
}
